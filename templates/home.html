{% extends 'base.html' %}
{% load static %}

{% block content %}
<main>
    <section class="hero">
        <div class="hero-content">
            <h1>{{ site_settings.hero_title|linebreaksbr }}</h1>
            <p>{{ site_settings.hero_subtitle }}</p>
            <a href="#ebooks" class="btn-gold reveal active"
                style="transition-delay: 0.4s; color: #ffffff !important; display: inline-block; text-align: center; z-index: 10; position: relative; opacity: 1 !important;">{{ site_settings.hero_button_text|default:"SAIBA MAIS" }}</a>
        </div>
    </section>

    <section id="sobre">
        <div class="container">
            <div class="sobre-grid reveal">
                <div class="sobre-img-container">
                    <!-- Foto REAL do Instagram -->
                    {% if site_settings.about_image %}
                    <img src="{{ site_settings.about_image.url }}" alt="Dilvania Teixeira" class="sobre-img">
                    {% else %}
                    <img src="{% static 'img/dilvania-profile-final.png' %}" alt="Dilvania Teixeira" class="sobre-img">
                    {% endif %}
                </div>
                <div class="sobre-texto">
                    <h3>{{ site_settings.about_title }}</h3>
                    <p>{{ site_settings.about_description|linebreaksbr }}</p>
                    <img src="img/dilvania-profile-final.png"
                        alt="Assinatura" style="height: 50px; opacity: 0.5; margin-top: 20px;">
                </div>
            </div>
        </div>
    </section>

    <section id="servicos">
        <div class="container">
            <h2 class="reveal">Solu√ß√µes <span>Exclusivas</span></h2>
            <div class="servicos-grid">
                {% for service in services %}
                <div class="servico-card reveal">
                    <i class="{{ service.icon }} servico-icon"></i>
                    <h3>{{ service.title }}</h3>
                    <p>{{ service.description }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- TERM√îMETRO DA RIQUEZA (LUCRO REAL VS ILUS√ÉO) -->
    <section id="simulador"
        style="background: linear-gradient(135deg, #1a1a1a 0%, #2c3e50 100%); color: #fff; padding: 60px 0;">
        <div class="container">
            <h2 class="reveal" style="text-align: center; color: #fff; margin-bottom: 10px; font-size: 2.5rem;">
                Term√¥metro da
                <span>Riqueza</span>
            </h2>
            <p style="text-align: center; max-width: 600px; margin: 0 auto 40px; opacity: 0.8; padding: 0 15px;">
                Muitos empres√°rios acham que t√™m lucro, mas est√£o apenas girando dinheiro. Descubra a verdade sobre sua
                empresa agora.
            </p>

            <div class="calculator-wrapper">
                <style>
                    .calculator-wrapper {
                        background: rgba(255, 255, 255, 0.05);
                        border: 1px solid rgba(255, 255, 255, 0.1);
                        border-radius: 20px;
                        padding: 40px;
                        max-width: 900px;
                        margin: 0 auto;
                        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
                    }

                    .calc-grid {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 40px;
                        align-items: center;
                    }

                    .calc-input-group {
                        margin-bottom: 20px;
                        position: relative;
                    }

                    .calc-label {
                        display: block;
                        margin-bottom: 8px;
                        font-weight: 600;
                        color: #c5a059;
                        font-size: 0.9rem;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }

                    .calc-input {
                        width: 100%;
                        padding: 15px;
                        border-radius: 8px;
                        border: 1px solid rgba(255, 255, 255, 0.1);
                        background: rgba(0, 0, 0, 0.4);
                        color: #fff;
                        font-size: 1.1rem;
                        box-sizing: border-box;
                        transition: all 0.3s;
                    }

                    .calc-input:focus {
                        border-color: #c5a059;
                        background: rgba(0, 0, 0, 0.6);
                        outline: none;
                        box-shadow: 0 0 15px rgba(197, 160, 89, 0.2);
                    }

                    .btn-calc {
                        width: 100%;
                        padding: 18px;
                        background: linear-gradient(135deg, #c5a059 0%, #a67c00 100%);
                        border: none;
                        border-radius: 50px;
                        color: #fff;
                        font-weight: 800;
                        cursor: pointer;
                        font-size: 1.1rem;
                        transition: 0.3s;
                        margin-top: 10px;
                        text-transform: uppercase;
                        letter-spacing: 1px;
                        box-shadow: 0 10px 20px rgba(197, 160, 89, 0.3);
                    }

                    .btn-calc:hover {
                        transform: translateY(-3px);
                        box-shadow: 0 15px 30px rgba(197, 160, 89, 0.5);
                    }

                    .calc-results {
                        background: rgba(255, 255, 255, 0.05);
                        border-radius: 15px;
                        padding: 30px;
                        text-align: center;
                        border: 1px solid rgba(255, 255, 255, 0.1);
                        transition: all 0.5s ease;
                    }

                    .health-badge {
                        display: inline-block;
                        padding: 8px 20px;
                        border-radius: 20px;
                        font-weight: bold;
                        text-transform: uppercase;
                        font-size: 0.9rem;
                        margin-bottom: 20px;
                        transition: all 0.5s;
                    }

                    .badge-danger {
                        background: rgba(231, 76, 60, 0.2);
                        color: #e74c3c;
                        border: 1px solid #e74c3c;
                    }

                    .badge-warning {
                        background: rgba(243, 156, 18, 0.2);
                        color: #f39c12;
                        border: 1px solid #f39c12;
                    }

                    .badge-success {
                        background: rgba(46, 204, 113, 0.2);
                        color: #2ecc71;
                        border: 1px solid #2ecc71;
                    }

                    .result-value {
                        font-size: 3rem;
                        font-weight: 800;
                        margin: 10px 0;
                        transition: color 0.5s;
                    }

                    .result-desc {
                        font-size: 1rem;
                        opacity: 0.8;
                        margin-bottom: 20px;
                        line-height: 1.5;
                    }

                    /* RESPONSIVE CSS */
                    @media (max-width: 768px) {
                        .calculator-wrapper {
                            padding: 25px 20px;
                            margin: 0 10px;
                        }

                        .calc-grid {
                            grid-template-columns: 1fr;
                            gap: 30px;
                        }

                        .result-value {
                            font-size: 2.2rem;
                        }
                    }

                    /* Lead Modal Styles */
                    .lead-modal {
                        display: none;
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0, 0, 0, 0.85);
                        z-index: 9999;
                        justify-content: center;
                        align-items: center;
                        padding: 20px;
                    }

                    .lead-modal-content {
                        background: #1a1a1a;
                        padding: 40px;
                        border-radius: 20px;
                        border: 1px solid #c5a059;
                        max-width: 500px;
                        width: 100%;
                        position: relative;
                        box-shadow: 0 0 50px rgba(197, 160, 89, 0.2);
                    }

                    .lead-modal-close {
                        position: absolute;
                        top: 15px;
                        right: 20px;
                        color: #fff;
                        font-size: 24px;
                        cursor: pointer;
                    }
                </style>

                <div class="calc-grid">
                    <!-- Inputs -->
                    <div class="calc-inputs">
                        <div class="calc-input-group">
                            <label class="calc-label">Faturamento Mensal (R$)</label>
                            <input type="number" id="faturamento" class="calc-input" placeholder="Ex: 50000"
                                oninput="calculateRealProfit()">
                        </div>
                        <div class="calc-input-group">
                            <label class="calc-label">Custos Totais (Empresa)</label>
                            <input type="number" id="custos" class="calc-input" placeholder="Ex: 35000"
                                oninput="calculateRealProfit()">
                        </div>
                        <div class="calc-input-group">
                            <label class="calc-label">Sua Retirada (Pr√≥-Labore + Pessoais)</label>
                            <input type="number" id="retirada" class="calc-input" placeholder="Ex: 10000"
                                oninput="calculateRealProfit()">
                            <small style="display: block; margin-top: 5px; opacity: 0.6; font-size: 0.8rem;">(Inclua
                                escola, mercado, cart√£o pessoal pago pela empresa)</small>
                        </div>
                    </div>

                    <!-- Results -->
                    <div class="calc-results" id="result-box">
                        <div id="health-badge" class="health-badge badge-warning">AGUARDANDO DADOS...</div>

                        <p style="margin: 0; opacity: 0.7; font-size: 0.9rem;">Verdadeiro Lucro Mensal:</p>
                        <div id="real-profit" class="result-value">R$ 0,00</div>

                        <p id="feedback-text" class="result-desc">
                            Preencha os campos ao lado para descobrir se sua empresa trabalha para voc√™ ou se voc√™ √©
                            escravo dela.
                        </p>

                        <a href="javascript:void(0)" onclick="openLeadModal()" class="btn-gold"
                            style="padding: 10px 25px; font-size: 0.9rem; text-decoration: none; display: inline-block;">
                            QUERO CORRIGIR ISSO
                        </a>
                    </div>
                </div>

                <!-- Lead Modal -->
                <div id="leadModal" class="lead-modal">
                    <div class="lead-modal-content">
                        <span class="lead-modal-close" onclick="closeLeadModal()">&times;</span>
                        <h3 style="color:#c5a059; margin-bottom: 20px; text-align: center;">Receba seu Diagn√≥stico</h3>
                        <p style="text-align: center; margin-bottom: 25px; opacity: 0.8;">Informe seus dados para salvar
                            sua an√°lise e falar com um especialista.</p>

                        <div class="calc-input-group">
                            <label class="calc-label">Seu Nome</label>
                            <input type="text" id="lead_name" class="calc-input" placeholder="Ex: Jo√£o Silva">
                        </div>
                        <div class="calc-input-group">
                            <label class="calc-label">WhatsApp</label>
                            <input type="text" id="lead_phone" class="calc-input" placeholder="Ex: (11) 99999-9999">
                        </div>

                        <button onclick="saveLeadAndGo()" id="btn-save-lead" class="btn-gold"
                            style="width: 100%; padding: 15px; margin-top: 10px; cursor: pointer; border: none;">
                            SALVAR E FALAR NO WHATSAPP
                        </button>
                    </div>
                </div>

                <script>
                    function calculateRealProfit() {
                        const faturamento = parseFloat(document.getElementById('faturamento').value) || 0;
                        const custos = parseFloat(document.getElementById('custos').value) || 0;
                        const retirada = parseFloat(document.getElementById('retirada').value) || 0;

                        if (faturamento === 0) return;

                        const lucroOperacional = faturamento - custos;
                        const lucroReal = lucroOperacional - retirada;
                        const margemReal = (lucroReal / faturamento) * 100;

                        const formatter = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });
                        const profitEl = document.getElementById('real-profit');
                        const badgeEl = document.getElementById('health-badge');
                        const textEl = document.getElementById('feedback-text');
                        const boxEl = document.getElementById('result-box');

                        profitEl.innerText = formatter.format(lucroReal);

                        // L√≥gica de Diagn√≥stico
                        if (lucroReal < 0) {
                            // Preju√≠zo
                            badgeEl.className = 'health-badge badge-danger';
                            badgeEl.innerText = '‚ö†Ô∏è ALERTA VERMELHO';
                            profitEl.style.color = '#e74c3c';
                            textEl.innerHTML = `Sua empresa <strong>n√£o se paga</strong>. Voc√™ est√° financiando a opera√ß√£o com seu futuro ou criando d√≠vidas ocultas.`;
                            boxEl.style.borderColor = '#e74c3c';
                        } else if (margemReal < 10) {
                            // Lucro Baixo
                            badgeEl.className = 'health-badge badge-warning';
                            badgeEl.innerText = 'CUIDADO: MARGEM BAIXA';
                            profitEl.style.color = '#f39c12';
                            textEl.innerHTML = `Sua margem real √© de apenas <strong>${margemReal.toFixed(1)}%</strong>. Qualquer imprevisto pode te levar ao preju√≠zo.`;
                            boxEl.style.borderColor = '#f39c12';
                        } else {
                            // Lucro Saud√°vel
                            badgeEl.className = 'health-badge badge-success';
                            badgeEl.innerText = '‚úÖ EMPRESA SAUD√ÅVEL';
                            profitEl.style.color = '#2ecc71';
                            textEl.innerHTML = `Parab√©ns! Sua margem real √© de <strong>${margemReal.toFixed(1)}%</strong>. Agora √© hora de escalar e multiplicar esse capital.`;
                            boxEl.style.borderColor = '#2ecc71';
                        }
                    }

                    let lastCalcData = { revenue: 0, profit: 0, health: '' };

                    function openLeadModal() {
                        const faturamento = parseFloat(document.getElementById('faturamento').value) || 0;
                        if (faturamento === 0) {
                            alert("Por favor, preencha o faturamento primeiro!");
                            return;
                        }

                        // Captura dados atuais do c√°lculo
                        const custos = parseFloat(document.getElementById('custos').value) || 0;
                        const retirada = parseFloat(document.getElementById('retirada').value) || 0;
                        const lucroReal = (faturamento - custos) - retirada;
                        const badgeText = document.getElementById('health-badge').innerText;

                        lastCalcData = {
                            revenue: faturamento,
                            profit: lucroReal,
                            health: badgeText
                        };

                        document.getElementById('leadModal').style.display = 'flex';
                    }

                    function closeLeadModal() {
                        document.getElementById('leadModal').style.display = 'none';
                    }

                    async function saveLeadAndGo() {
                        const name = document.getElementById('lead_name').value;
                        const phone = document.getElementById('lead_phone').value;
                        const btn = document.getElementById('btn-save-lead');

                        if (!name || !phone) {
                            alert("Por favor, preencha seu nome e WhatsApp.");
                            return;
                        }

                        btn.innerText = "Sincronizando...";
                        btn.disabled = true;

                        try {
                            const response = await fetch('/api/save-lead/', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': '{{ csrf_token }}'
                                },
                                body: JSON.stringify({
                                    name: name,
                                    phone: phone,
                                    revenue: lastCalcData.revenue,
                                    profit: lastCalcData.profit,
                                    health: lastCalcData.health
                                })
                            });

                            const result = await response.json();

                            const msg = encodeURIComponent(`Ol√° Dilvania! Acabei de fazer o teste do Term√¥metro da Riqueza no seu site.\n\nMeu Resultado: ${lastCalcData.health}\nMeu Lucro Real: R$ ${lastCalcData.profit.toLocaleString('pt-BR')}\n\nGostaria de entender como podemos melhorar isso.`);
                            window.open(`https://wa.me/5511982675531?text=${msg}`, '_blank');
                            closeLeadModal();

                        } catch (e) {
                            console.error(e);
                            window.open(`https://wa.me/5511982675531?text=Ol√° Dilvania! Vi seu site e gostaria de falar sobre gest√£o financeira.`, '_blank');
                        } finally {
                            btn.innerText = "SALVAR E FALAR NO WHATSAPP";
                            btn.disabled = false;
                        }
                    }
                </script>
            </div>
        </div>
    </section>

    <!-- Mobile Responsive Styles for Bonus Section -->
    <style>
        /* Specific Fixes for Bonus Section Responsiveness */
        @media (max-width: 768px) {
            #bonus .container>div {
                padding: 40px 20px !important;
                border-width: 1px !important;
            }

            #bonus h2 {
                font-size: 1.6rem !important;
                /* Smaller title on mobile */
            }

            #bonus .btn-checkout-lg {
                padding: 15px 20px !important;
                font-size: 1rem !important;
                width: 100%;
            }

            .ribbon {
                top: 15px !important;
                right: -45px !important;
                padding: 5px 60px !important;
                font-size: 0.7rem !important;
            }
        }
    </style>


    <!-- EXCLUSIVE BONUS SECTION -->
    <section id="bonus"
        style="background: #fdfbf7; padding: 100px 0; text-align: center; border-bottom: 1px solid #eee;">
        <div class="container">
            <div
                style="background: white; border: 2px dashed #c5a059; border-radius: 20px; padding: 60px 40px; max-width: 900px; margin: 0 auto; box-shadow: 0 20px 50px rgba(0,0,0,0.08); position: relative; overflow: hidden;">

                <!-- Ribbon -->
                <div class="ribbon"
                    style="position: absolute; top: 30px; right: -50px; background: #c5a059; color: white; padding: 10px 100px; transform: rotate(45deg); font-weight: bold; font-size: 0.9rem; letter-spacing: 2px; box-shadow: 0 5px 10px rgba(0,0,0,0.2);">
                    BRINDE</div>

                {% if site_settings.bonus_image %}
                <img src="{{ site_settings.bonus_image.url }}" alt="B√¥nus" class="scale-loop"
                    style="max-height: 120px; margin-bottom: 20px;">
                {% else %}
                <i class="fas fa-gift scale-loop"
                    style="font-size: 4rem; color: #c5a059; margin-bottom: 30px; display: inline-block;"></i>
                {% endif %}

                <h2 style="font-size: 2.5rem; margin-bottom: 20px; color: #1a1a1a; font-weight: 800; line-height: 1.2;">
                    {% if site_settings.bonus_title %}
                    {{ site_settings.bonus_title|safe }}
                    {% else %}
                    O "Pulo do Gato" que Faltava na Sua Gest√£o
                    {% endif %}
                </h2>

                <div style="font-size: 1.2rem; color: #555; max-width: 700px; margin: 0 auto 40px; line-height: 1.8;">
                    {% if site_settings.bonus_subtitle %}
                    {{ site_settings.bonus_subtitle|linebreaks }}
                    {% else %}
                    Eu preparei algo que voc√™ n√£o encontra em lugar nenhum. N√£o √© apenas uma planilha, √© o Mapa do
                    Tesouro da sua liberdade financeira.
                    {% endif %}
                </div>

                <a href="{% if site_settings.bonus_spreadsheet %}{{ site_settings.bonus_spreadsheet.url }}{% else %}{% static 'docs/planilha_financeira_exclusiva.csv' %}{% endif %}"
                    download class="btn-checkout-lg"
                    style="display: inline-block; width: auto; padding: 20px 60px; font-size: 1.1rem; box-shadow: 0 10px 30px rgba(197, 160, 89, 0.4);">
                    <i class="fas fa-download" style="margin-right: 15px;"></i>
                    {% if site_settings.bonus_button_text %}
                    {{ site_settings.bonus_button_text }}
                    {% else %}
                    BAIXAR "O MAPA DO TESOURO"
                    {% endif %}
                </a>

                <p
                    style="margin-top: 20px; font-size: 0.85rem; color: #999; text-transform: uppercase; letter-spacing: 1px;">
                    <i class="fas fa-lock"></i> Acesso Gratuito e Instant√¢neo
                </p>

                <style>
                    @keyframes scaleLoop {
                        0% {
                            transform: scale(1);
                        }

                        50% {
                            transform: scale(1.1);
                        }

                        100% {
                            transform: scale(1);
                        }
                    }

                    .scale-loop {
                        animation: scaleLoop 3s infinite ease-in-out;
                    }
                </style>
            </div>
        </div>
    </section>

    <!-- NOVA SE√á√ÉO DE EBOOKS -->
    <section id="ebooks">
        <div class="container">
            <h2>Conhecimento <span>Digital</span></h2>
            <p style="text-align: center; max-width: 600px; margin: 0 auto 50px; color: var(--cor-texto-secundario);">
                Manuais pr√°ticos e guias estrat√©gicos dispon√≠veis para download imediato.
            </p>

            <div class="ebook-grid">
                {% for product in products %}
                <div class="ebook-card reveal">
                    <div class="ebook-cover {% if product.cover_image %}has-image{% endif %}">
                        {% if product.cover_image %}
                        <img src="{{ product.cover_image.url }}" alt="Capa {{ product.title }}"
                            style="width: 100%; height: 100%; object-fit: cover;">
                        {% else %}
                        <i class="fas fa-book"></i>
                        {% endif %}
                    </div>
                    <div class="ebook-info">
                        <h3 class="ebook-title">{{ product.title }}</h3>
                        <p class="ebook-desc">{{ product.description|truncatechars:100 }}</p>
                        <div class="ebook-price">R$ {{ product.price }}</div>
                        <a href="{% url 'product_detail' product.slug %}" class="btn-buy">Ver Detalhes e Comprar</a>
                    </div>
                </div>
                {% empty %}
                <p style="text-align: center; width: 100%;">Nenhum produto cadastrado ainda.</p>
                {% endfor %}
            </div>
        </div>
    </section>

    <section class="social-strip">
        <div class="container">
            <h3>Siga-me nas redes sociais</h3>
            <div style="margin-top: 30px;">
                <a href="https://www.instagram.com/dilvania.teixeira" target="_blank"><i
                        class="fab fa-instagram"></i></a>
                <a href="https://br.linkedin.com/in/dilvaniateixeira" target="_blank"><i
                        class="fab fa-linkedin"></i></a>
                <a href="https://wa.me/5511989996055" target="_blank"><i class="fab fa-whatsapp"></i></a>
            </div>
        </div>
    </section>

    <section id="contato" style="background-color: var(--cor-fundo-secundario);">
        <div class="container">
            <h2>Vamos <span>Conversar?</span></h2>
            <div style="text-align: center; max-width: 700px; margin: auto;">

                {% if messages %}
                {% for message in messages %}
                <div
                    style="background-color: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    {{ message }}
                </div>
                {% endfor %}
                {% endif %}

                <p>Entre em contato para agendar uma reuni√£o ou tirar d√∫vidas. Preencha o formul√°rio abaixo:</p>

                <style>
                    .contact-form-wrapper {
                        background: #ffffff;
                        padding: 40px;
                        border-radius: 16px;
                        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
                        max-width: 650px;
                        margin: 40px auto 0;
                        text-align: left;
                        border: 1px solid rgba(0, 0, 0, 0.05);
                    }

                    .form-group {
                        margin-bottom: 25px;
                    }

                    .form-label {
                        display: block;
                        font-weight: 600;
                        margin-bottom: 8px;
                        color: #2c3e50;
                        font-size: 0.95rem;
                        letter-spacing: 0.5px;
                    }

                    .form-control {
                        width: 100%;
                        padding: 14px 18px;
                        border: 2px solid #eef0f5;
                        border-radius: 10px;
                        font-size: 1rem;
                        color: #333;
                        background: #fdfdfd;
                        transition: all 0.3s ease;
                        box-sizing: border-box;
                    }

                    .form-control:focus {
                        border-color: #c5a059;
                        background: #fff;
                        outline: none;
                        box-shadow: 0 5px 15px rgba(197, 160, 89, 0.15);
                    }

                    .form-control::placeholder {
                        color: #aaa;
                    }

                    .btn-submit-premium {
                        background: linear-gradient(135deg, #c5a059 0%, #a67c00 100%);
                        color: white;
                        padding: 18px 30px;
                        border: none;
                        border-radius: 10px;
                        font-size: 1.1rem;
                        font-weight: 700;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        width: 100%;
                        text-transform: uppercase;
                        letter-spacing: 1px;
                        box-shadow: 0 10px 20px rgba(197, 160, 89, 0.3);
                    }

                    .btn-submit-premium:hover {
                        transform: translateY(-3px);
                        box-shadow: 0 15px 30px rgba(197, 160, 89, 0.4);
                        background: linear-gradient(135deg, #d4af6a 0%, #b88a00 100%);
                    }

                    .btn-submit-premium i {
                        margin-right: 10px;
                    }
                </style>

                <form id="contactForm" onsubmit="event.preventDefault(); sendEmail();" class="contact-form-wrapper">
                    {% csrf_token %}

                    <!-- Nome -->
                    <div class="form-group">
                        <label for="id_name" class="form-label">SEU NOME</label>
                        <input type="text" name="name" maxlength="100" required id="id_name" class="form-control"
                            placeholder="Digite seu nome completo">
                    </div>

                    <!-- Email -->
                    <div class="form-group">
                        <label for="id_email" class="form-label">SEU E-MAIL</label>
                        <input type="email" name="email" maxlength="254" required id="id_email" class="form-control"
                            placeholder="exemplo@email.com">
                    </div>

                    <!-- Telefone -->
                    <div class="form-group">
                        <label for="id_phone" class="form-label">WHATSAPP</label>
                        <input type="text" name="phone" maxlength="20" required id="id_phone" class="form-control"
                            placeholder="(DDD) 99999-9999">
                    </div>

                    <!-- Mensagem -->
                    <div class="form-group">
                        <label for="id_message" class="form-label">COMO POSSO TE AJUDAR?</label>
                        <textarea name="message" cols="40" rows="4" required id="id_message" class="form-control"
                            placeholder="Escreva sua mensagem aqui..."></textarea>
                    </div>

                    <div style="text-align: center; margin-top: 35px;">
                        <button type="submit" class="btn-submit-premium">
                            <i class="fas fa-paper-plane"></i> Enviar Mensagem
                        </button>
                    </div>
                </form>

                <script>
                    function sendEmail() {
                        // Fun√ß√£o renomeada para manter compatibilidade com onsubmit antigo, 
                        // mas agora envia para WhatsApp!
                        var name = document.getElementById('id_name').value;
                        var email = document.getElementById('id_email').value;
                        var phone = document.getElementById('id_phone').value;
                        var message = document.getElementById('id_message').value;

                        // Valida√ß√£o b√°sica
                        if (!name || !phone) {
                            alert("Por favor, preencha pelo menos Nome e WhatsApp.");
                            return;
                        }

                        var text = "*Novo Lead do Site (Scalabis)*\n\n" +
                            "üë§ *Nome:* " + name + "\n" +
                            "üìß *Email:* " + email + "\n" +
                            "üì± *Whats:* " + phone + "\n\n" +
                            "üí¨ *Mensagem:* \n" + message;

                        var encodedText = encodeURIComponent(text);
                        // Link universal que abre App no mobile ou Web no desktop
                        var waLink = "https://wa.me/5511989996055?text=" + encodedText;

                        window.open(waLink, '_blank');
                    }
                </script>

                <p style="margin-top: 20px; font-size: 1.1rem; color: var(--cor-texto);">
                    <i class="fas fa-map-marker-alt" style="color: var(--cor-destaque);"></i> Carapicu√≠ba - SP
                    &nbsp;|&nbsp;
                    <i class="fas fa-phone" style="color: var(--cor-destaque);"></i> (11) 98999-6055
                </p>
                <a href="mailto:dilvania.teixeira@dsop.com.br"
                    style="display: inline-block; margin-top: 20px; font-size: 1.2rem; color: var(--cor-destaque); font-weight: 700;">
                    dilvania.teixeira@dsop.com.br
                </a>
            </div>
        </div>
    </section>

    <!-- WIDGET IA FLUTUANTE -->
    <div id="ai-widget" class="ai-widget">
        <div class="ai-bubble" id="ai-bubble">
            Psiu! ü§´ Sua empresa d√° lucro de verdade?
            <div class="ai-bubble-arrow"></div>
            <button class="ai-close" onclick="document.getElementById('ai-bubble').style.display='none'">√ó</button>
        </div>
        <a href="https://wa.me/5511989996055?text=Ol√°,%20vi%20o%20site%20e%20quero%20saber%20se%20minha%20empresa%20est√°%20dando%20lucro%20mesmo."
            class="ai-button" target="_blank" title="Falar com Especialista">
            <i class="fab fa-whatsapp"></i>
            <span class="online-dot"></span>
        </a>
    </div>

    <style>
        .ai-widget {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .ai-button {
            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
            color: white;
            width: 65px;
            height: 65px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            text-decoration: none;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .ai-button:hover {
            transform: scale(1.1) rotate(-10deg);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            color: white;
        }

        .online-dot {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 15px;
            height: 15px;
            background: #e74c3c;
            border-radius: 50%;
            border: 2px solid white;
            animation: pulse-red 2s infinite;
        }

        .ai-bubble {
            background: white;
            color: #333;
            padding: 15px 20px;
            border-radius: 15px 15px 2px 15px;
            font-size: 0.95rem;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            margin-bottom: 15px;
            max-width: 250px;
            position: relative;
            opacity: 0;
            transform: translateY(20px);
            animation: popIn 0.5s forwards 2s;
            /* Aparece ap√≥s 2s */
            border: 1px solid #eee;
        }

        .ai-bubble-arrow {
            position: absolute;
            bottom: -8px;
            right: 20px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid white;
        }

        .ai-close {
            position: absolute;
            top: -8px;
            left: -8px;
            background: #eee;
            color: #777;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 14px;
            cursor: pointer;
            line-height: 1;
        }

        @keyframes popIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse-red {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7);
            }

            70% {
                transform: scale(1.1);
                box-shadow: 0 0 0 10px rgba(231, 76, 60, 0);
            }

            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(231, 76, 60, 0);
            }
        }

        /* Mobile Adjustments */
        @media (max-width: 480px) {
            .ai-widget {
                bottom: 20px;
                right: 20px;
            }

            .ai-button {
                width: 55px;
                height: 55px;
                font-size: 28px;
            }

            .ai-bubble {
                font-size: 0.85rem;
                padding: 12px 15px;
                margin-bottom: 10px;
                right: 0;
            }
        }
    </style>
</main>
{% endblock %}
